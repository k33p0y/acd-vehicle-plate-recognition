{% if logged %}
    <input type="hidden" id="flow" value="out">
    <button type="button" class="btn btn-danger btn-block" onclick="parkInOut()">Park-Out Vehicle</button>
{% else %}
    <input type="hidden" id="flow" value="in">
    <div class="form-group">
      <label for="reason">Reason</label>
      <input type="text" name="reason" id="reason" class="form-control" value="" onkeypress="inputReason(event)" autofocus>
      <p class="form-text text-danger" id="help-text"></p>
    </div>
    <button type="button" class="btn btn-success btn-block" onclick="parkInOut()">Park-In Vehicle</button>
{% endif %}

{% block script %}
<script>
    var loading = false;
    parkInOut = () => {
        if (!loading) {
            $('.btn').addClass('hide');
            $('.form-control').addClass('hide');
            loading = true;
            var reason = $('#reason').val();
            var flow = $('#flow').val();
            if (flow == 'in') {
                if (reason.trim().length == 0) {
                    $('#help-text').html('Reason is required');
                    $('#reason').focus();
                    loading = false;
                    $('.btn').removeClass('hide');
                    $('.form-control').removeClass('hide');
                    return false;
                }
            }

            request.open('GET', '/api/park-inout?reason=' + reason, true);

            request.onload = function() {
                if (this.status >= 200 && this.status < 400) {
                    var resp = JSON.parse(this.response);
                    console.info(`parked-${resp.flow}`);
                } else {
                    console.error('parked error');
                }
                loading = false;
                $('.btn').removeClass('hide');
                $('.form-control').removeClass('hide');
            };
            request.onerror = function() {
                loading = false;
                $('.btn').removeClass('hide');
                $('.form-control').removeClass('hide');
                console.error('parked error');
            };
            request.send();
        }
    }

    inputReason = ($e) => {
        if ($e.keyCode == 13) {
            parkInOut();
        }
    };
</script>
{% endblock script %}